# 全局配置
global:
  log:
    level: "info"         # 日志级别: debug, info, warning, error
    format: "text"        # 日志格式: text 或 json
    output: "console"     # 日志输出: console 或 file
    file_path: "./logs/ai_dataflux.log"  # 当output=file时有效
  flux_api_url: http://127.0.0.1:8787    # Flux API端点URL

# 数据源类型配置
datasource:
  type: excel   # 数据源类型: mysql 或 excel
  require_all_input_fields: true  # 输入字段检查: true=全部非空才处理, false=至少一个非空即可
  concurrency:
    batch_size: 100        # 批处理大小（也用作最大并发任务数）
    save_interval: 300     # Excel文件保存间隔（秒）
    shard_size: 10000      # 默认分片大小
    min_shard_size: 1000   # 最小分片大小
    max_shard_size: 50000  # 最大分片大小
    api_pause_duration: 2.0        # API错误时全局暂停秒数
    api_error_trigger_window: 2.0  # 多少秒内的API错误才会触发暂停
    max_connections: 1000          # aiohttp的最大并发连接数
    max_connections_per_host: 0    # 对每个主机的最大并发连接数（0表示无限制）
    retry_limits:                  # 按错误类型配置重试次数
      api_error: 3                 # API错误（超时、HTTP错误）最多重试次数
      content_error: 1             # 内容错误（JSON解析失败）最多重试次数
      system_error: 2              # 系统错误（内部异常）最多重试次数

# MySQL数据源配置（仅当type=mysql时有效）
mysql:
  host: "localhost"
  port: 3306
  user: "root"
  password: "your_password"
  database: "ai_tasks"
  table_name: "tasks"

# Excel数据源配置（仅当type=excel时有效）
excel:
  input_path: "./data/input.xlsx"
  output_path: "./data/output.xlsx"

# 需要从表中提取的字段
columns_to_extract:
  - "question"
  - "context"

# 需要写回表的字段(别名->真实字段名)
columns_to_write:
  answer: "ai_answer"
  category: "ai_category" 
  confidence: "ai_confidence"
  sentiment: "ai_sentiment"

# 字段值验证配置
validation:
  enabled: true
  field_rules:
    category:
      - "technical"
      - "business"
      - "general"
    sentiment:
      - "positive"
      - "neutral"
      - "negative"

# 模型配置
models:
  - id: 1
    name: "model-1"               # 模型显示名称
    model: "gpt-4-turbo"          # 实际模型标识符
    channel_id: "1"               # 所属通道ID
    api_key: "your_api_key_1"     # API密钥
    timeout: 300                  # 超时时间（秒）
    weight: 10                    # 调度权重（使用加权随机算法）
    temperature: 0.3              # 模型温度
    safe_rps: 5                   # 每秒安全请求数（令牌桶限流）
    supports_json_schema: true    # 是否支持JSON Schema输出格式
    supports_advanced_params: true  # 是否支持高级参数（presence_penalty等）

  - id: 2
    name: "model-2"
    model: "claude-3-opus"
    channel_id: "2"
    api_key: "your_api_key_2"
    timeout: 300
    weight: 5
    temperature: 0.3
    safe_rps: 3
    supports_json_schema: true
    supports_advanced_params: false

  - id: 3
    name: "model-3"
    model: "llama-3-70b"
    channel_id: "3"
    api_key: "your_api_key_3"
    timeout: 300
    weight: 3
    temperature: 0.3
    safe_rps: 10
    supports_json_schema: false
    supports_advanced_params: false

# 通道配置
channels:
  "1":
    name: "openai-api"
    base_url: "https://api.openai.com"
    api_path: "/v1/chat/completions"
    timeout: 300
    proxy: ""         # 可选代理设置，例如 "http://127.0.0.1:7890"
    ssl_verify: true  # SSL证书验证开关，Mac上遇到证书问题可设为false


# 提示词配置
prompt:
  required_fields:
    - "answer"
    - "category"
    - "confidence"
    - "sentiment"
  use_json_schema: true
  temperature: 0.3  # 较低温度确保分类准确性
  system_prompt: |
    你是一个专业的数据分析师，擅长从复杂数据中提取有价值的信息。请根据提供的数据和上下文，给出准确、深入的分析和建议。
  template: |
    请分析以下数据并提供专业的回答:

    {record_json}
    
    系统要求:
    1. 请详细分析问题和上下文，提供准确、有深度的回答
    2. 回答应专业、清晰、有条理，避免冗余内容
    3. 必须返回JSON格式的结果，包含以下字段:
       - answer: 详细的回答内容
       - category: 问题类别，可选值为 "technical"、"business"、"general"
       - confidence: 置信度评分，范围0-100的整数
       - sentiment: 情感倾向，可选值为 "positive"、"neutral"、"negative"
    
    格式示例:
    {
      "answer": "这里是详细的回答内容...",
      "category": "technical",
      "confidence": 95,
      "sentiment": "neutral"
    }
    
    请确保回答是JSON格式，且仅包含JSON内容，不需要额外的解释文字。
